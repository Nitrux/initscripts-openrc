#!/sbin/openrc-run

description="Miscellaneous things to be done during bootup"

depend() {
    need localmount
    after mountnfs-bootclean
}

start_pre() {
    # Set default value for DELAYLOGIN
    : ${DELAYLOGIN:=yes}
    # If login delaying is enabled then create the flag file
    case "${DELAYLOGIN}" in
      [Yy]*)
        echo "System bootup in progress - please wait" > /run/nologin
        ;;
    esac
}

start() {
    ebegin "Performing miscellaneous bootup tasks"

    # Remove bootclean's flag files.
    rm -f /tmp/.clean /run/.clean /run/lock/.clean
    rm -f /tmp/.tmpfs /run/.tmpfs /run/lock/.tmpfs

    # Reset /var/run/utmp
    local utmp='/var/run/utmp'
    if : > "${utmp}"; then
        chgrp utmp "${utmp}" || ewarn "failed to chgrp ${utmp}"
        chmod 664 "${utmp}" || ewarn "failed to chmod ${utmp}"
        [ -x /sbin/restorecon ] && /sbin/restorecon "${utmp}"
    else
        eerror "failed to truncate ${utmp}"
        eend 1
        return 1
    fi

    eend 0
}

stop() {
    return 0
}

status() {
    return 0
}
